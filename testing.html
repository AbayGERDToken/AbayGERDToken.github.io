<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Abay GERD Token Claim</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>


  <style>.page-inner { background-color: rgb(255, 255, 255); min-height: 100vh; }</style>
  <style>.img-left { float: middle ; width: 150px; height: auto; margin-right: 10px; } </style>

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; }
    
    input, button { width: 200px; padding: 10px; margin: 10px 0; }
    .success { color: green; }
    .error { color: red; }
    .loading { color: blue; }
    .g-recaptcha { margin: 10px 0; }
    .container { max-width: 400px; margin: auto; padding: 2em; }
    input#recipient { width: 400px; }
    </style>
</head>
<body>
  <div id="navbar"></div>

  <div class="container">
    <h2 class="title">Claim your GERD tokens</h2>
    <p>Please note that we never ask users to connect their wallets. To receive GERD tokens,
      simply provide your GERD wallet address.<br>
     <br>Before proceeding with your claim, please ensure that the Abay GERD token contract has been setup into your wallet, 
    and that you have obtained your GERD wallet address. If not, please do so by following the instructions using the <a href="trust-wallet.html">
    Trust Wallet</a> or <a href="metamask-wallet.html"> MetaMask Wallet</a>. Other wallet options are <a href="https://halo.social/" target="_blank">
    Halo Wallet </a>, <a href="https://www.exodus.com/" target="_blank"> Exodus Wallet </a> to list the few. The same instructions apply
    to all wallets.<br><br>
    The first 500,000 wallets originated in Ethiopia will automatically received 7,500 Abay GERD tokens. Users outside Ethiopia will
    recieve 1,000 tokens at this time. </p><br>
  </div>

  <div class="container">
    <p> <strong>(After pressing the "Claim Tokens" button, kindly allow up to 45 seconds to receive a confirmation message
        indicating that your claim has been successful)</strong>
   </div>
  
  <div class="container">
  
    <h2>Claim Your Abay GERD Tokens</h2>
    <input type="text" id="recipient" placeholder="Enter Your GERD Wallet Address" />
    <div class="g-recaptcha" data-sitekey="6LdQyRkrAAAAANv5siZlVghMFzQ2AEPIg8501G9P"></div>
    <button class="button is-success" onclick="claimTokens()">Claim Tokens</button>
    <p id="response"></p>
  </div>

  <div class="container">
    <tr>
      <td style="width:205px">&nbsp;</td>
      <td style="width:993px">
          <h2 class="subtitle"> Check your balance</h2>
          <form>
      <div>
<label for="bwallet-address">Wallet Address:</label><br>
<input class="input is-success" type="text" placeholder="GERD wallet address" id="bwallet-address" name="bwallet-address" />
<button class="button is-success" type="button" id="check-balance">Check Balance</button>
<strong><div id="balance-result">Balance: N/A </div></strong>
</div>
          </form>
      </td>
  </tr>
  </div>
  
  <section class="hero is-success is-bold">
    <div class="hero-body">
      <div class="container">
        <div class="columns is-vcentered">
          <div class="column">
            <h2 class="subtitle">
                DISCOVER ABAY GERD TOKEN, THE ETHIOPIAN-BORN CRYPTOCURRENCY EMPOWERING OUR COMMUNITY AND SUPPORTING THE GRAND ETHIOPIAN RENAISSANCE DAM PROJECT.
                 JOIN US IN CREATING A BRIGHTER FUTURE! üåçüí∞ #ABAYGERDTOKEN #ETHIOPIA #CRYPTO #GERD
            </h2>
          </div>
          <div class="column has-text-centered">
            <img src="image/abay_bluesky.png" alt="AbayGERDToken" style="width: 300px; height: auto;">
          </div>
        </div>
      </div>
    </div>
</section>
<script>
  const web3a = new Web3("https://bsc-dataseed.binance.org/");
const contractABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},
  {"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
           {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
           {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balances","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
           {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
           {"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}];

const contractAddress = "0x660941bb4AA9FcBED00375673D21088A9d0C5019";
const gerdContract = new web3a.eth.Contract(contractABI, contractAddress);

document.getElementById("check-balance").addEventListener("click", async () => {
  const walletAddress = document.getElementById("bwallet-address").value;

  if (!web3a.utils.isAddress(walletAddress)) {
    // alert("Please enter a valid wallet address.");
    document.getElementById("balance-result").innerText = `Error: Please enter a valid address`;
    return;
  }

  try {
  const balance = await gerdContract.methods.balanceOf(walletAddress).call();
  const formattedBalance = (balance / 10**2).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  document.getElementById("balance-result").innerText = `Your balance is: ${formattedBalance} GERD`;
  } catch (error) {
    console.error("Error fetching balance:", error);
    alert("An error occurred while fetching the balance.");
  }
});
</script>

  <script>
    async function claimTokens() {
      const recipient = document.getElementById('recipient').value.trim();
      const responseEl = document.getElementById('response');
      const buttonEl = document.querySelector('button');
      const recaptchaToken = grecaptcha.getResponse();

      if (!web3a.utils.isAddress(recipient)) {
        responseEl.textContent = "Please enter a valid wallet address.";
        responseEl.className = "error";
        return;
      }

      if (!recaptchaToken) {
        responseEl.textContent = "Please complete the reCAPTCHA.";
        responseEl.className = "error";
        return;
      }

      buttonEl.disabled = true;
      buttonEl.textContent = "Processing...";
      responseEl.textContent = "üîé Checking your location...";
      responseEl.className = "loading";

      try {
        // Detect IP and Country
        const locResponse = await fetch('https://ipapi.co/json/');
        const locData = await locResponse.json();
        let amount = (locData.country_code === "ET") ? 7500 : 1000;

        responseEl.textContent = `üåç Detected Country: ${locData.country_name}. Preparing to send ${amount} GERD Tokens...`;

        // Submit claim to backend
        const res = await fetch('https://abay-gerd-backend.onrender.com/send-token', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            recipient,
            amount,
            ip: locData.ip,
            country: locData.country_name,
            city: locData.city,
            recaptchaToken,
            secret: '41e91afe062ea4a9ff5ca65ada9f7820' 
          })
        });

        const data = await res.json();
        if (data.status === 'success') {
          responseEl.innerHTML = `‚úÖ Success! Tokens sent.<br>Tx Hash: <a href="https://bscscan.com/tx/0x${data.tx_hash}" target="_blank">${data.tx_hash}</a> üéâ`;
          responseEl.className = "success";
        } else {
          responseEl.textContent = `‚ùå Error: ${data.message}`;
          responseEl.className = "error";
        }
      } catch (err) {
        responseEl.textContent = `‚ùå Error: ${err.message}`;
        responseEl.className = "error";
      } finally {
        buttonEl.disabled = false;
        buttonEl.textContent = "Claim Tokens";
        grecaptcha.reset();
      }
    }
  </script>
  
  <!-- Add more sections as needed -->

 
  <footer class="footer">
    <div class="content has-text-centered">
      <p style="font-size: 0.85rem;">
        Copyright 2023 Abay GERD Token. All rights reserved.
      </p>
    </div>
  </footer>
  <script>
    $(function() {
      $("#navbar").load("abaynav.html", function() {
        // Get all "navbar-burger" elements
        const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
        // Check if there are any navbar burgers
        if ($navbarBurgers.length > 0) {
          // Add a click event on each of them
          $navbarBurgers.forEach(el => {
            el.addEventListener('click', () => {
              // Get the target from the "data-target" attribute
              const target = el.dataset.target;
              const $target = document.getElementById(target);
              // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
              el.classList.toggle('is-active');
              $target.classList.toggle('is-active');
            });
          });
        }
      });
    });
  </script>  
</body>
</html>
