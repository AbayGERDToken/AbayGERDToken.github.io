<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Abay GERD Token Claim</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <style>.page-inner { background-color: rgb(255, 255, 255); min-height: 100vh; }</style>
  <style>.img-left { float: middle ; width: 150px; height: auto; margin-right: 10px; } </style>

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; }
    
    input, button { width: 200px; padding: 10px; margin: 10px 0; }
    .success { color: green; }
    .error { color: red; }
    .loading { color: blue; }
    .g-recaptcha { margin: 10px 0; }
    .container { max-width: 400px; margin: auto; padding: 2em; }
    input#recipient { width: 400px; }
    </style>
</head>
<body>
  <div id="navbar"></div>
  <div class="container">
    <p> <strong>(After pressing the "Claim Tokens" button, kindly allow up to 45 seconds to receive a confirmation message
        indicating that your claim has been successful)</strong>
   </div>
  
  <div class="container">
  
    <h2>Claim Your Abay GERD Tokens</h2>
    <input type="text" id="recipient" placeholder="Enter Your GERD Wallet Address" />
    <div class="g-recaptcha" data-sitekey="6LdQyRkrAAAAANv5siZlVghMFzQ2AEPIg8501G9P"></div>
    <button class="button is-success" onclick="claimTokens()">Claim Tokens</button>
    <p id="response"></p>
  </div>
  
  <section class="hero is-success is-bold">
    <div class="hero-body">
      <div class="container">
        <div class="columns is-vcentered">
          <div class="column">
            <h2 class="subtitle">
                DISCOVER ABAY GERD TOKEN, THE ETHIOPIAN-BORN CRYPTOCURRENCY EMPOWERING OUR COMMUNITY AND SUPPORTING THE GRAND ETHIOPIAN RENAISSANCE DAM PROJECT.
                 JOIN US IN CREATING A BRIGHTER FUTURE! üåçüí∞ #ABAYGERDTOKEN #ETHIOPIA #CRYPTO #GERD
            </h2>
          </div>
          <div class="column has-text-centered">
            <img src="image/abay_bluesky.png" alt="AbayGERDToken" style="width: 300px; height: auto;">
          </div>
        </div>
      </div>
    </div>
</section>

  <script>
    async function claimTokens() {
      const recipient = document.getElementById('recipient').value.trim();
      const responseEl = document.getElementById('response');
      const buttonEl = document.querySelector('button');
      const recaptchaToken = grecaptcha.getResponse();

      if (!recipient) {
        responseEl.textContent = "Please enter your wallet address.";
        responseEl.className = "error";
        return;
      }

      if (!recaptchaToken) {
        responseEl.textContent = "Please complete the reCAPTCHA.";
        responseEl.className = "error";
        return;
      }

      buttonEl.disabled = true;
      buttonEl.textContent = "Processing...";
      responseEl.textContent = "üîé Checking your location...";
      responseEl.className = "loading";

      try {
        // Detect IP and Country
        const locResponse = await fetch('https://ipapi.co/json/');
        const locData = await locResponse.json();
        let amount = (locData.country_code === "ET") ? 7500 : 1000;

        responseEl.textContent = `üåç Detected Country: ${locData.country_name}. Preparing to send ${amount} GERD Tokens...`;

        // Submit claim to backend
        const res = await fetch('https://abay-gerd-backend.onrender.com/send-token', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            recipient,
            amount,
            ip: locData.ip,
            country: locData.country_name,
            city: locData.city,
            recaptchaToken,
            secret: '41e91afe062ea4a9ff5ca65ada9f7820' 
          })
        });

        const data = await res.json();
        if (data.status === 'success') {
          responseEl.innerHTML = `‚úÖ Success! Tokens sent.<br>Tx Hash: <a href="https://bscscan.com/tx/0x${data.tx_hash}" target="_blank">${data.tx_hash}</a> üéâ`;
          responseEl.className = "success";
        } else {
          responseEl.textContent = `‚ùå Error: ${data.message}`;
          responseEl.className = "error";
        }
      } catch (err) {
        responseEl.textContent = `‚ùå Error: ${err.message}`;
        responseEl.className = "error";
      } finally {
        buttonEl.disabled = false;
        buttonEl.textContent = "Claim Tokens";
        grecaptcha.reset();
      }
    }
  </script>
  

  <!-- Add more sections as needed -->

 
  <footer class="footer">
    <div class="content has-text-centered">
      <p style="font-size: 0.85rem;">
        Copyright 2023 Abay GERD Token. All rights reserved.
      </p>
    </div>
  </footer>
  <script>
    $(function() {
      $("#navbar").load("abaynav.html", function() {
        // Get all "navbar-burger" elements
        const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
        // Check if there are any navbar burgers
        if ($navbarBurgers.length > 0) {
          // Add a click event on each of them
          $navbarBurgers.forEach(el => {
            el.addEventListener('click', () => {
              // Get the target from the "data-target" attribute
              const target = el.dataset.target;
              const $target = document.getElementById(target);
              // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
              el.classList.toggle('is-active');
              $target.classList.toggle('is-active');
            });
          });
        }
      });
    });
  </script>  
</body>
</html>
