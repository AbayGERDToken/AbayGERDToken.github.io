<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Abay GERD Token Claim</title>
  
  <!-- Bootstrap 5.3.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/main.css"/>
  
  <!-- Web3 -->
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  
  <!-- reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>

  <!-- Dynamic Navbar -->
  <div id="navbar-container"></div>
  <script>
    fetch('navtest.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('navbar-container').innerHTML = html;
      })
      .catch(err => console.error('Error loading navbar:', err));
  </script>

<section class="py-5 mt-5">
  <div class="container">
    <!-- Trigger link -->
    <a href="#" onclick="openChangeModal()" class="text-decoration-none mb-3 d-inline-block">
      <i class="fas fa-bullhorn text-primary"></i> See Claim Update
    </a>

    <!-- Modal Container -->
    <div id="changeModal">
      <div>
        <button type="button" class="close-btn" onclick="closeChangeModal()" aria-label="Close">&times;</button>
        <h3 class="h4 mb-3"><i class="fas fa-gift text-warning"></i> GERD Token Claim Update – Starting 05/05/2025</h3>
        <p>Increase in the total amount of GERD Tokens available for claiming:</p>
        <ul class="ps-4">
          <li><i class="fas fa-earth-americas text-primary"></i> <strong>Global Claim:</strong> Increased from <strong>1,000 GERD</strong> to <strong>10,000 GERD</strong></li>
          <li><i class="fas fa-flag text-danger"></i> <strong>Ethiopia-Specific Claim:</strong> Increased from <strong>7,500 GERD</strong> to <strong>75,000 GERD</strong></li>
        </ul>
        <p><strong>Wallets that have previously claimed before the increase</strong> will receive a <strong>10x airdrop bonus</strong> based on their original claim amount. <i class="fas fa-gift text-warning"></i></p>
        <p><em>Example: If you previously claimed 1,000 GERD, you will receive 10,000 GERD via airdrop on 05/05/2025.</em></p>
        <p><i class="fas fa-check-circle text-success"></i> Thank you for supporting the GERD mission!</p>
      </div>
    </div>

    <h2 class="h2 mb-4">Claim Your GERD Tokens <i class="fas fa-gift text-warning"></i> <i class="fas fa-key text-info"></i></h2>
    <p>
      <i class="fas fa-check-circle text-success"></i> <strong>No wallet connection required.</strong><br/>
      To claim your free GERD tokens, simply submit your wallet address. 
      We never ask users to connect or sign transactions—your privacy and safety come first.
    </p>
    <br/>
    <p>
      <i class="fas fa-search text-info"></i> Before submitting your claim:
    </p>
      <ul class="list-unstyled">
      <li class="mb-2"><i class="fas fa-mobile-alt text-primary"></i> Ensure you've imported the <strong>Abay GERD Token contract</strong> into your wallet</li>
      <li class="mb-2"><i class="fas fa-id-card text-warning"></i> Use a supported wallet like 
        
        <a href="https://www.coinbase.com/wallet"><strong>Base - Coinbase</strong></a>,
        <a href="trust-wallet.html"><strong>Trust Wallet</strong></a>, 
        <a href="metamask-wallet.html"><strong>MetaMask</strong></a>, 
        <strong>Atomic</strong>, etc...</li>
        
     

      <!--<div class="box" align="left"> --> 
      <span>
         <li class="mb-2"><i class="fas fa-earth-americas text-success"></i> The process is the same for all wallets — Import custom token and enter
        <div class="d-flex align-items-center mt-2">
          <code id="contractAddress" class="text-primary me-2">0x6B16DE4F92e91e91357b5b02640EBAf5be9CF83c</code>
          <button onclick="copyToClipboard()" class="btn btn-sm btn-outline-primary" type="button">
            <i id="copyIcon" class="fas fa-copy copy-icon"></i>
            <i id="checkIcon" class="fas fa-check text-success d-none"></i>
          </button>
        </div>
      </li>
    <!-- </div> --> 
      </li>
    </ul>

    
      <h3 class="h5 mt-4 mb-3"><i class="fas fa-map-pin text-danger"></i> Claim Eligibility</h3>
      <ul class="list-unstyled">
        <li class="mb-2"><i class="fas fa-flag text-danger"></i> <strong>Ethiopia-based wallets:</strong> Receive <strong>75,000 GERD</strong></li>
        <li class="mb-2"><i class="fas fa-earth-americas text-primary"></i> <strong>Global wallets:</strong> Receive <strong>10,000 GERD</strong></li>
      </ul>
    
   </div>
  
  <div class="container my-5">
    <h2 class="h3 mb-3">Wallet Address:</h2>
    <div class="claim-form-container">
      <input class="form-control mb-3" type="text" id="recipient" placeholder="GERD Wallet Address" />
      <div class="g-recaptcha mb-3" data-sitekey="6LdQyRkrAAAAANv5siZlVghMFzQ2AEPIg8501G9P"></div>
      <button class="btn btn-success" onclick="claimTokens()">Claim Tokens</button>
      <p id="response" class="mt-3"></p>
    </div>
  </div>

  <div class="container my-5">
    <h3 class="h5 mb-3">Check your balance</h3>
    <form>
      <div class="mb-3">
        <label for="bwallet-address" class="form-label">Wallet Address:</label>
        <input class="form-control" type="text" placeholder="GERD wallet address" id="bwallet-address" name="bwallet-address"/>
      </div>
      <button class="btn btn-success" type="button" id="check-balance">Check Balance</button>
      <div id="balance-result" class="mt-3 fw-bold">Balance: N/A</div>
    </form>
  </div>
</section>
<section class="bg-success-subtle py-5 mb-0">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h2 class="h5 mb-3">
          DISCOVER ABAY GERD TOKEN, THE ETHIOPIAN-BORN CRYPTOCURRENCY EMPOWERING OUR COMMUNITY AND SUPPORTING THE GRAND ETHIOPIAN RENAISSANCE DAM PROJECT.
          JOIN US IN CREATING A BRIGHTER FUTURE! <i class="fas fa-earth-americas text-primary"></i> <i class="fas fa-coins text-warning"></i> #ABAYGERDTOKEN #ETHIOPIA #CRYPTO #GERD
        </h2>
      </div>
      <div class="col-md-4 text-center">
        <img src="image/abay_bluesky.png" alt="AbayGERDToken" class="img-fluid img-hero">
      </div>
    </div>
  </div>
</section>
<script>
  const web3a = new Web3("https://bsc-dataseed.binance.org/");
const contractABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},
  {"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
           {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
           {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balances","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
           {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
           {"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}];

const contractAddress = "0x6B16DE4F92e91e91357b5b02640EBAf5be9CF83c";
const gerdContract = new web3a.eth.Contract(contractABI, contractAddress);

document.getElementById("check-balance").addEventListener("click", async () => {
  const walletAddress = document.getElementById("bwallet-address").value;

  if (!web3a.utils.isAddress(walletAddress)) {
    // alert("Please enter a valid wallet address.");
    document.getElementById("balance-result").innerText = `Error: Please enter a valid address`;
    return;
  }

  try {
  const balance = await gerdContract.methods.balanceOf(walletAddress).call();
  const formattedBalance = (balance / 10**2).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  document.getElementById("balance-result").innerText = `Balance: ${formattedBalance} GERD`;
  } catch (error) {
    console.error("Error fetching balance:", error);
    alert("An error occurred while fetching the balance.");
  }
});
</script>

<script>
  let sessionToken = "";

  async function fetchSessionToken() {
    try {
      const res = await fetch('https://abay-gerd-backend.onrender.com/auth/session');
      const data = await res.json();
      sessionToken = data.session_token;
      return sessionToken;
   }  catch (err) {
      console.error("Failed to get session token:", err);
      return null;
    }
  }


  async function claimTokens() {
    const recipient = document.getElementById('recipient').value.trim();
    const responseEl = document.getElementById('response');
    const buttonEl = document.querySelector('button');
    const recaptchaToken = grecaptcha.getResponse();

    if (!web3a.utils.isAddress(recipient)) {
      responseEl.textContent = "Please enter a valid wallet address.";
      responseEl.className = "error";
      return;
    }

    if (!recaptchaToken) {
      responseEl.textContent = "Please complete the reCAPTCHA.";
      responseEl.className = "error";
      return;
    }
    if (!sessionToken) {
      await fetchSessionToken();
      if (!sessionToken) {
        responseEl.textContent = "Error: Session not initialized. Please wait a few seconds and try again.";
        responseEl.className = "error";
        return;
      }
    }


    buttonEl.disabled = true;
    buttonEl.textContent = "Processing...";
      responseEl.innerHTML = "<i class='fas fa-search text-primary'></i> Checking your location...";
      responseEl.className = "status-loading";

    try {
      const locResponse = await fetch('https://ipapi.co/json/');
      const locData = await locResponse.json();
      const estimatedAmount = (locData.country_code === "ET") ? 75000 : 10000;

      responseEl.innerHTML = `<i class='fas fa-earth-americas text-primary'></i> Detected Country: ${locData.country_name}. Preparing to send approximately ${estimatedAmount} GERD Tokens...`;

      const res = await fetch('https://abay-gerd-backend.onrender.com/send-token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          recipient,
          recaptchaToken,
          session_token: sessionToken
        })
      });

      const data = await res.json();
      if (data.status === 'success') {
        responseEl.innerHTML = `<i class='fas fa-check-circle text-success'></i> Success! Tokens sent.<br>Tx Hash: <a href="https://bscscan.com/tx/0x${data.tx_hash}" target="_blank">0x${data.tx_hash}</a> <i class='fas fa-gift text-warning'></i>`;
        responseEl.className = "status-success";
      } else {
        responseEl.innerHTML = `<i class='fas fa-times-circle text-danger'></i> Error: ${data.message}`;
        responseEl.className = "status-error";
      }
    } catch (err) {
      responseEl.innerHTML = `<i class='fas fa-times-circle text-danger'></i> Error: ${err.message}`;
      responseEl.className = "status-error";
    } finally {
      buttonEl.disabled = false;
      buttonEl.textContent = "Claim Tokens";
      grecaptcha.reset();
    }
  }
</script>

  
  <!-- Add more sections as needed -->

 
<footer class="bg-dark text-light py-4">
  <div class="container text-center">
    <p class="small mb-0">
      <a href="mailto:contact@abaygerdtoken.com?subject=Claim Form" class="text-light text-decoration-none"><strong>Contact us</strong></a> with claim related issues<br>
      Copyright 2023 Abay GERD Token. All rights reserved.
    </p>
  </div>
</footer>

<!-- JavaScript to control modal -->
<script>
  function openChangeModal() {
    document.getElementById('changeModal').style.display = 'flex';
  }

  function closeChangeModal() {
    document.getElementById('changeModal').style.display = 'none';
  }
  
  function copyToClipboard() {
    const contractAddress = "0x6B16DE4F92e91e91357b5b02640EBAf5be9CF83c";
    const copyIcon = document.getElementById("copyIcon");
    const checkIcon = document.getElementById("checkIcon");

    navigator.clipboard.writeText(contractAddress).then(function() {
      copyIcon.classList.add('d-none');
      checkIcon.classList.remove('d-none');
      setTimeout(() => {
        checkIcon.classList.add('d-none');
        copyIcon.classList.remove('d-none');
      }, 1500);
    }).catch(function(err) {
      alert("Copy failed. Please copy manually.");
    });
  }
</script>

<!-- Bootstrap 5.3.3 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>