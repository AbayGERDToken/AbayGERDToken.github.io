<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>GERD Token Vesting Dashboard - Testnet</title>
  
  <!-- Bootstrap 5.3.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  
  <!-- Google Fonts - Outfit -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/main.css"/>
  
  <!-- Web3 -->
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  
  <style>
    :root {
      --gerd-primary: #198754;
      --gerd-dark: #0f5132;
      --gerd-light: #d1e7dd;
    }
    
    .hero-section {
      background: linear-gradient(135deg, var(--gerd-primary) 0%, var(--gerd-dark) 100%);
      color: white;
      padding: 60px 0;
      position: relative;
      overflow: hidden;
    }
    
    .hero-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M 100 0 L 0 0 0 100" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      opacity: 0.3;
    }
    
    .hero-content {
      position: relative;
      z-index: 1;
    }
    
    .feature-card {
      border: none;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin-bottom: 30px;
    }
    
    .feature-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    
    .content-section {
      padding: 80px 0;
    }
    
    .stat-card {
      background: linear-gradient(135deg, var(--gerd-light) 0%, white 100%);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      border: 2px solid var(--gerd-light);
      transition: all 0.3s ease;
      height: 100%;
    }
    
    .stat-card:hover {
      border-color: var(--gerd-primary);
      transform: scale(1.05);
    }
    
    .countdown-text {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gerd-primary);
      font-family: 'Courier New', monospace;
    }
    
    .contract-box {
      background: var(--gerd-light);
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid var(--gerd-primary);
    }
    
    #wallet-table {
      border-radius: 12px;
      overflow: hidden;
    }
    
    #wallet-table th {
      background-color: #198754;
      color: white;
      font-weight: 600;
      padding: 16px;
    }
    
    #wallet-table td {
      padding: 14px 16px;
    }
  </style>
</head>
<body>
  <!-- Dynamic Navbar -->
  <div id="navbar-container"></div>
  <script>
    fetch('navtest.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('navbar-container').innerHTML = html;
      })
      .catch(err => console.error('Error loading navbar:', err));
  </script>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content">
        <div class="row">
          <div class="col-lg-10 mx-auto text-center">
            <h1 class="display-4 fw-bold mb-4"><i class="fas fa-chart-line me-3"></i>Vesting Release Dashboard on Testnet</h1>
            <p class="lead fs-5 opacity-90">Real-time tracking of the GERD Token Vesting contract testing on BSC Testnet</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Dashboard -->
  <section class="content-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 mx-auto">
          
          <!-- Info Alert -->
          <div class="alert alert-info border-info mb-5">
            <div class="d-flex align-items-start">
              <div class="bg-info-subtle text-info rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px; font-size: 24px; flex-shrink: 0;">
                <i class="fas fa-info-circle"></i>
              </div>
              <div>
                <h4 class="h6 fw-bold mb-2">Testnet Testing Information</h4>
                <p class="mb-0 small">This dashboard is for community members to follow the progress of the GERD Token Vesting contract testing on the BSC Testnet. To simulate a long-term token release (1 billion GERD tokens per year for 115 years), the vesting contract on testnet is configured to release 1 billion tokens every Wednesday. This allows for faster testing of what would normally happen over years in production. The data below is read directly from the blockchain and updates in real-time.</p>
              </div>
            </div>
          </div>

          <!-- Release Control Card -->
          <div class="card feature-card mb-5">
            <div class="card-body p-5">
              <h2 class="h4 fw-bold mb-4 text-center"><i class="fas fa-rocket text-success me-2"></i>Release Control</h2>
              <div class="text-center mb-4">
                <a href="dev/release_token.html" class="btn btn-success btn-lg">
                  <i class="fas fa-rocket me-2"></i>Release Tokens
                </a>
              </div>
              <div class="row g-4">
                <div class="col-md-6">
                  <div class="stat-card">
                    <div class="bg-primary-subtle text-primary rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 64px; height: 64px; font-size: 28px;">
                      <i class="fas fa-clock"></i>
                    </div>
                    <h3 class="h6 fw-bold mb-2">Countdown to Next Release</h3>
                    <p id="releaseCountdown" class="countdown-text mb-0">Calculating...</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="stat-card">
                    <div class="bg-success-subtle text-success rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 64px; height: 64px; font-size: 28px;">
                      <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 class="h6 fw-bold mb-2">Can Release Now</h3>
                    <p id="canRelease" class="h5 text-primary mb-0">Loading...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Contract Details Card -->
          <div class="card feature-card mb-5">
            <div class="card-body p-5">
              <h2 class="h4 fw-bold mb-4"><i class="fas fa-file-contract text-primary me-2"></i>Contract Details</h2>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="contract-box">
                    <p class="mb-2 small text-muted"><strong>Testnet CA:</strong></p>
                    <a href="https://testnet.bscscan.com/token/0x85a4850d0c2bdd6202c919c481bf0f186222fa89" target="_blank" class="text-decoration-none">
                      <code class="text-success fw-bold">0x85a4850d0c2bdd6202c919c481bf0f186222fa89</code>
                      <i class="fas fa-external-link-alt ms-2 text-success"></i>
                    </a>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="contract-box">
                    <p class="mb-2 small text-muted"><strong>Testnet VC:</strong></p>
                    <a href="https://testnet.bscscan.com/address/0xC3C2b095C3aA55ACecc7fBA44C6B9D3f56dC43Da" target="_blank" class="text-decoration-none">
                      <code class="text-success fw-bold">0xC3C2b095C3aA55ACecc7fBA44C6B9D3f56dC43Da</code>
                      <i class="fas fa-external-link-alt ms-2 text-success"></i>
                    </a>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="contract-box">
                    <p class="mb-2 small text-muted"><strong>Testnet VC2:</strong></p>
                    <a href="https://testnet.bscscan.com/address/0x2005408916003b37555D5A9B539867b387534e34" target="_blank" class="text-decoration-none">
                      <code class="text-success fw-bold">0x2005408916003b37555D5A9B539867b387534e34</code>
                      <i class="fas fa-external-link-alt ms-2 text-success"></i>
                    </a>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="contract-box">
                    <p class="mb-2 small text-muted"><strong>Network:</strong></p>
                    <p class="mb-0 fw-bold text-primary">BSC Testnet</p>
                  </div>
                </div>
              </div>
              <hr class="my-4">
              <div class="row g-3">
                <div class="col-md-4">
                  <p class="mb-2 small text-muted"><strong>Last Release Time:</strong></p>
                  <p id="lastRelease" class="fw-bold text-primary mb-0">Loading...</p>
                </div>
                <div class="col-md-4">
                  <p class="mb-2 small text-muted"><strong>Is Today Wednesday:</strong></p>
                  <p id="isWednesday" class="fw-bold text-primary mb-0">Loading...</p>
                </div>
                <div class="col-md-4">
                  <p class="mb-2 small text-muted"><strong>Next Scheduled Release:</strong></p>
                  <p id="nextReleaseDate" class="fw-bold text-primary mb-0">Loading...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Wallet Balances Card -->
          <div class="card feature-card mb-5">
            <div class="card-body p-4">
              <h2 class="h4 fw-bold mb-4 text-center"><i class="fas fa-wallet text-success me-2"></i>Wallet Balances</h2>
              <div class="table-responsive">
                <table id="wallet-table" class="table table-striped table-hover mb-0">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Balance (GERD)</th>
                      <th>Wallet Address</th>
                    </tr>
                  </thead>
                  <tbody id="walletTable">
                    <tr>
                      <td colspan="3" class="text-center py-5">
                        <i class="fas fa-spinner fa-spin fa-2x text-muted mb-3 d-block"></i>
                        <p class="text-muted mb-0">Loading balances...</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Release History Card -->
          <div class="card feature-card">
            <div class="card-body p-5">
              <h2 class="h4 fw-bold mb-4 text-center"><i class="fas fa-history text-info me-2"></i>Release History</h2>
              <ul class="list-unstyled mb-0" id="releaseHistory">
                <li class="text-center text-muted">Loading...</li>
              </ul>
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>

  <section class="bg-success-subtle py-5 mb-0">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h2 class="h5 mb-3">
            DISCOVER ABAY GERD TOKEN, THE ETHIOPIAN-BORN CRYPTOCURRENCY EMPOWERING OUR COMMUNITY AND SUPPORTING THE GRAND ETHIOPIAN RENAISSANCE DAM PROJECT.
            JOIN US IN CREATING A BRIGHTER FUTURE! #ABAYGERDTOKEN #ETHIOPIA #CRYPTO #GERD
          </h2>
        </div>
        <div class="col-md-4 text-center">
          <img src="image/abay_bluesky.png" alt="AbayGERDToken" class="img-fluid img-hero">
        </div>
      </div>
    </div>
  </section>

  <footer class="bg-dark text-light py-4">
    <div class="container text-center">
      <p class="small mb-0">
        Copyright 2023 Abay GERD Token. All rights reserved.
      </p>
    </div>
  </footer>

  <script>
    const contractAddress = "0xC3C2b095C3aA55ACecc7fBA44C6B9D3f56dC43Da";
    const contractABI = [
      {
        inputs: [],
        name: "lastReleaseTime",
        outputs: [{ internalType: "uint256", name: "", type: "uint256" }],
        stateMutability: "view",
        type: "function"
      }
    ];

    const web3 = new Web3("https://data-seed-prebsc-1-s1.binance.org:8545/");
    const contract = new web3.eth.Contract(contractABI, contractAddress);

    function getNextWednesdayTimestamp(fromTimestamp) {
      const SECONDS_IN_DAY = 86400;
      const day = Math.floor(fromTimestamp / SECONDS_IN_DAY + 4) % 7;
      const daysUntilNextWednesday = (7 + 3 - day) % 7 || 7;
      return (Math.floor(fromTimestamp / SECONDS_IN_DAY) + daysUntilNextWednesday) * SECONDS_IN_DAY;
    }

    async function loadDashboard() {
      try {
        const lastRelease = await contract.methods.lastReleaseTime().call();
        const isNeverReleased = lastRelease === "0";
        const now = Math.floor(Date.now() / 1000);

        document.getElementById("lastRelease").textContent = isNeverReleased
          ? "No token release has occurred yet"
          : new Date(lastRelease * 1000).toUTCString();

        const jsDay = new Date().getUTCDay();
        const isWed = jsDay === 3;
        document.getElementById("isWednesday").innerHTML = isWed 
          ? '<span class="badge bg-success"><i class="fas fa-check-circle me-1"></i>Yes</span>' 
          : '<span class="badge bg-danger"><i class="fas fa-times-circle me-1"></i>No</span>';

        const nextReleaseTime = isNeverReleased
          ? getNextWednesdayTimestamp(now)
          : parseInt(lastRelease) + 7 * 86400;
        document.getElementById("nextReleaseDate").textContent = new Date(nextReleaseTime * 1000).toUTCString();

        // Countdown
        const secondsLeft = nextReleaseTime - now;
        const days = Math.floor(secondsLeft / 86400);
        const hours = Math.floor((secondsLeft % 86400) / 3600);
        const minutes = Math.floor((secondsLeft % 3600) / 60);
        document.getElementById("releaseCountdown").textContent = secondsLeft > 0 
          ? `${days}d ${hours}h ${minutes}m` 
          : "Ready to release";

        // Can Release
        const releaseReady = now >= nextReleaseTime && isWed;
        document.getElementById("canRelease").innerHTML = releaseReady 
          ? '<span class="badge bg-success fs-6"><i class="fas fa-check-circle me-1"></i>Yes</span>' 
          : '<span class="badge bg-danger fs-6"><i class="fas fa-times-circle me-1"></i>No</span>';

        // Release History
        const historyList = document.getElementById("releaseHistory");
        if (isNeverReleased) {
          historyList.innerHTML = '<li class="text-center text-muted"><i class="fas fa-info-circle me-2"></i>No releases yet</li>';
        } else {
          historyList.innerHTML = `<li class="d-flex align-items-center justify-content-center"><i class="fas fa-clock text-primary me-2"></i><span>Last release: <strong>${new Date(lastRelease * 1000).toUTCString()}</strong></span></li>`;
        }
      } catch (err) {
        console.error("Error loading dashboard:", err);
        document.getElementById("releaseCountdown").textContent = "Error loading";
        document.getElementById("canRelease").innerHTML = '<span class="text-danger">Error</span>';
      }
    }

    const GERDTokenAddress = "0x85a4850d0c2bdd6202c919c481bf0f186222fa89";
    const tokenABI = [
      {
        constant: true,
        inputs: [{ name: "account", type: "address" }],
        name: "balanceOf",
        outputs: [{ name: "", type: "uint256" }],
        type: "function"
      },
      {
        constant: true,
        inputs: [],
        name: "decimals",
        outputs: [{ name: "", type: "uint8" }],
        type: "function"
      }
    ];

    const addresses = [
      { name: "Airdrop Wallet", addr: "0x87CC9e804B4A840297b18536D5d0E7A4835B0e3c" },
      { name: "Staking Wallet", addr: "0x3B84a366a2f25BbB48f34b2b8D587c02237E6a13" },
      { name: "Liquidity Wallet", addr: "0xdA96DBeDD6eF3f4f2b503565A7c6a5a65fbabf17" },
      { name: "Vesting Contract", addr: "0xC3C2b095C3aA55ACecc7fBA44C6B9D3f56dC43Da" },
      { name: "GERD Test Wallet", addr: "0xd84DB57e0d89cF6487b426e6BBbAb235b1139445" }
    ];

    const token = new web3.eth.Contract(tokenABI, GERDTokenAddress);

    async function loadBalances() {
      try {
        const decimals = await token.methods.decimals().call();
        let rows = "";
        for (const entry of addresses) {
          const balance = await token.methods.balanceOf(entry.addr).call();
          const formatted = (balance / 10 ** decimals).toLocaleString("en-US");
          rows += `<tr>
            <td><strong>${entry.name}</strong></td>
            <td class="fw-bold text-success">${formatted}</td>
            <td class="font-monospace small"><a href="https://testnet.bscscan.com/address/${entry.addr}" target="_blank" class="text-decoration-none">${entry.addr} <i class="fas fa-external-link-alt ms-1"></i></a></td>
          </tr>`;
        }
        document.getElementById("walletTable").innerHTML = rows;
      } catch (err) {
        console.error("Error loading balances:", err);
        document.getElementById("walletTable").innerHTML = '<tr><td colspan="3" class="text-danger text-center py-4"><i class="fas fa-exclamation-triangle me-2"></i>Failed to load balances</td></tr>';
      }
    }

    loadDashboard();
    loadBalances();
    setInterval(loadDashboard, 60000); // Update every minute
  </script>

  <!-- Bootstrap 5.3.3 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
